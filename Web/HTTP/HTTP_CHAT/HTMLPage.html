<!DOCTYPE html>
<html>
<head>
    <meta lang="ru" />
</head>
<body>
<h3>
    Online чат

</h3>
    <span id="spa1"></span>
    <form>
        <textarea name="text" id="it34">
Ваш комментарий
</textarea>
        <button type="button" id="sb67">Отправить</button>
    </form>
   <textarea id="restext">

</textarea>
    <script>
       
        var but = document.getElementById("sb67");
        but.addEventListener("click", function () {
            let tx = document.getElementById("it34");
            if (tx.textContent != null && String(tx.textContent) != "") {
               
                var res = document.getElementById("spa1");
                try {
                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", "http://192.168.1.126:666/", true);
                    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                            var val_ = xhr.responseText;
                            const masn = val_.split('\n');
                            var rdial = document.getElementById("restext");
                            rdial.value = "";
                            for (var e = 0; e < masn.length; e++) {
                                rdial.value += decodeURI( masn[e]) + "\n\n";
                            }
                        };
                    };
                    var val_enc =  encodeURI(tx.value);
                    xhr.send(val_enc);
                    res.textContent = "ваше сообщение отправленно";
                   
                }
                catch {
                    res.textContent = "произошла ошибка отправки , повторите попытку";
                }
            }
        });
    </script>
</body>
</html>
